{% extends 'core/base_admin.html' %}
{% load static %}

{% block title %}Listado de Usuarios Bloqueados{% endblock %}
<head>
{% block extra_head%}
    <link rel="stylesheet" href="{% static 'administrador/css/lista_usuarios.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}
</head>

{% block content %}

<div class="acciones-derecha ancho-contenido">
    <a href="#" class="boton-header">
        Carga masiva
        <img src="{% static 'administrador/svg/carga-masiva.svg' %}">
    </a>

    <a href="#" class="boton-header">
        Dashboard usuarios
        <img src="{% static 'administrador/svg/reporteria.svg' %}">
    </a>

    <a href="#" class="boton-header">
        Perfil
        <img src="{% static 'administrador/svg/user-profile.svg' %}">
    </a>

    <a href="{% url 'agregar_usuario' %}" class="boton-header">
        Agregar Usuario
        <img src="{% static 'administrador/svg/plus.svg' %}">
    </a>


</div>

<h2 class="titulo">Listado de Usuarios Bloqueados</h2>

<div class="busqueda-agregar">
    <input type="text" placeholder="Buscar Usuario .........." class="input-busqueda">

    <a href="#" class="boton-header">
        Filtrar
        <img src="{% static 'administrador/svg/filter-solid.svg' %}">
    </a>
</div>

<div class="barra-acciones-usuarios ancho-contenido">
    <div class="boton-bloquear-seleccionados">
        <button id="bloquearBtn" disabled>Activar</button>
    </div>

    <div class="toggle-estado-usuarios">
        <a href="{% url 'lista_usuarios_activos' %}" class="estado-btn">Activos</a>
        <a href="{% url 'lista_usuarios_bloqueados' %}" class="estado-btn activo">Bloqueados</a>
    </div>
</div>

{% if usuarios %}
    <table class="tabla-usuarios">
        <thead>
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th>Nombre</th>
                <th>Rut</th>
                <th>Cargo</th>
                <th>Correo</th>
                <th>Tel√©fono</th>            
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for user in usuarios %}
            <tr>
                <td><input type="checkbox" class="select-user"></td>
                <td>{{ user.get_full_name }}</td>
                <td>{{ user.profile.rut }}</td>
                <td>
                    {% if user.groups.count > 1 %}
                        Ambos
                    {% elif user.groups.count == 1 %}
                        {{ user.groups.first.name }}
                    {% else %}
                        Sin rol
                    {% endif %}
                </td>
                <td>{{ user.email }}</td>
                <td>{{ user.profile.telefono }}</td>
                <td>
                    <button title="Bloquear"><img src="{% static 'core/svg/lock-open-solid.svg' %}" alt="Bloquear"></button>
                    <button title="Mostrar"><img src="{% static 'core/svg/user-regular.svg' %}" alt="Mostrar"></button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="custom-pagination">
        {% if usuarios.has_previous %}
          <a href="?page=1" class="page-btn">&laquo;</a>
          <a href="?page={{ usuarios.previous_page_number }}" class="page-btn">&lsaquo;</a>
        {% else %}
          <span class="page-btn disabled">&laquo;</span>
          <span class="page-btn disabled">&lsaquo;</span>
        {% endif %}

        <span class="page-btn current">{{ usuarios.number }}</span>

        {% if usuarios.has_next %}
          <a href="?page={{ usuarios.next_page_number }}" class="page-btn">&rsaquo;</a>
          <a href="?page={{ usuarios.paginator.num_pages }}" class="page-btn">&raquo;</a>
        {% else %}
          <span class="page-btn disabled">&rsaquo;</span>
          <span class="page-btn disabled">&raquo;</span>
        {% endif %}
    </div>
{% else %}
    <p style="text-align: center; font-size: 24px; margin-top: 40px;">No hay usuarios registrados.</p>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const selectAll = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('.select-user');
        const bloquearBtn = document.querySelector('.boton-bloquear-seleccionados button');
    
        function updateBloquearButton() {
            const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
            if (anyChecked) {
                bloquearBtn.classList.add('activo');
                bloquearBtn.disabled = false;
            } else {
                bloquearBtn.classList.remove('activo');
                bloquearBtn.disabled = true;
            }
        }
    
        // Al cambiar cualquier checkbox individual
        checkboxes.forEach(cb => {
            cb.addEventListener('change', updateBloquearButton);
        });
    
        // Al cambiar el "select-all"
        selectAll.addEventListener('change', () => {
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
            updateBloquearButton();
        });
    
        // Desactiva por defecto
        bloquearBtn.disabled = true;
    });
    </script>
{% endblock %}